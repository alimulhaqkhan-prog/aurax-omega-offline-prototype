<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AURA-X Œ© ‚Äì Emotional Continuity OS (Professional Prototype)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Optional: future-ready offline LLM via WebLLM (can be wired later) -->
  <script type="module">
    // This import is safe even if you don't use it yet; a developer can hook it later.
    import * as webllm from "https://esm.run/@mlc-ai/web-llm";
    window.webllm = webllm;
  </script>

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --accent: #0ea5e9;
      --accent-soft: rgba(14, 165, 233, 0.65);
      --accent-soft-2: rgba(34, 211, 238, 0.45);
      --bg-root: #020617;
      --bg-card: rgba(2, 6, 23, 0.70);
      --border-soft: rgba(148, 163, 184, 0.22);
      --radius-lg: 22px;
      --radius-md: 18px;
      --radius-pill: 999px;
      --shadow-main: 0 20px 60px rgba(0, 0, 0, 0.45);
      --font-sans: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      --font-mono: ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    body {
      font-family: var(--font-sans);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 20px 10px;
      background:
        radial-gradient(circle at 8% 0%, #1e293b 0, transparent 45%),
        radial-gradient(circle at 82% 0%, #0ea5e9 0, transparent 43%),
        linear-gradient(140deg, #020617 0, #020617 40%, #020617 100%);
      color: #e5e7eb;
    }

    .app {
      width: min(1020px, 100vw);
      background: rgba(2, 6, 23, 0.55);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(148, 163, 184, 0.24);
      overflow: hidden;
      box-shadow: var(--shadow-main);
      backdrop-filter: blur(14px);
    }

    /* ---------- HEADER ---------- */

    .top {
      padding: 18px 18px 10px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.16);
      text-align: center;
    }

    .brand {
      font-weight: 900;
      letter-spacing: 0.04em;
      font-size: 26px;
      color: #7dd3fc;
      text-shadow: 0 0 22px rgba(14, 165, 233, 0.30);
    }

    .brandSub {
      margin-top: 4px;
      font-size: 13px;
      opacity: 0.9;
    }

    .brandMeta {
      margin-top: 2px;
      font-size: 11px;
      opacity: 0.75;
    }

    .ethicBar {
      margin: 12px auto 10px;
      max-width: 760px;
      padding: 10px 14px;
      border-radius: 18px;
      background: rgba(15, 23, 42, 0.80);
      border: 1px solid rgba(251, 191, 36, 0.45);
      color: #fbbf24;
      text-align: left;
      box-shadow: inset 0 0 0 1px rgba(251, 191, 36, 0.12);
    }

    .ethicTitle {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      font-weight: 800;
      margin-bottom: 4px;
    }

    .ethicBody {
      font-size: 12px;
      line-height: 1.4;
    }

    .statusPill {
      margin: 8px auto 0;
      max-width: 760px;
      border-radius: var(--radius-pill);
      padding: 10px 18px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      font-weight: 800;
      background: linear-gradient(90deg, var(--accent-soft), var(--accent-soft-2));
      border: 1px solid rgba(125, 211, 252, 0.45);
      color: #020617;
      box-shadow: 0 12px 38px rgba(14, 165, 233, 0.24);
    }

    /* ---------- LAYOUT ---------- */

    .main {
      padding: 14px 14px 18px;
    }

    .row {
      display: flex;
      gap: 14px;
      flex-wrap: wrap;
      align-items: stretch;
    }

    .col-left  { flex: 1 1 360px; min-width: 320px; }
    .col-right { flex: 1 1 360px; min-width: 320px; }

    .card {
      background: var(--bg-card);
      border-radius: var(--radius-md);
      border: 1px solid rgba(148, 163, 184, 0.26);
      box-shadow: 0 12px 38px rgba(0, 0, 0, 0.30);
      padding: 14px;
      backdrop-filter: blur(12px);
    }

    .cardHeader {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 4px;
    }

    .cardTitle {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: #bfdbfe;
      font-weight: 800;
    }

    .cardTag {
      font-size: 10px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.45);
      text-transform: uppercase;
      letter-spacing: 0.10em;
      opacity: 0.9;
    }

    .cardSub {
      font-size: 11px;
      opacity: 0.80;
      margin-bottom: 10px;
    }

    /* ---------- SYSTEM CONSOLE ---------- */

    .console {
      margin-top: 4px;
      border-radius: 16px;
      border: 1px solid rgba(148, 163, 184, 0.18);
      background: rgba(0, 0, 0, 0.32);
      padding: 10px 12px;
      height: 220px;
      overflow: auto;
      font-family: var(--font-mono);
      font-size: 12px;
      white-space: pre-wrap;
      line-height: 1.55;
      box-shadow: inset 0 0 0 1px rgba(125, 211, 252, 0.08);
    }

    .logLine {
      margin: 1px 0;
      display: block;
    }
    .logLine.sys   { color: #facc15; }
    .logLine.user  { color: #c4b5fd; }
    .logLine.aura  { color: #bbf7d0; }

    .badgeRow {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
      font-size: 10px;
      font-family: var(--font-mono);
    }

    .badge {
      padding: 4px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.40);
      background: rgba(15, 23, 42, 0.85);
      color: #e5e7eb;
    }

    /* ---------- CONTINUITY METRICS ---------- */

    .metricsGrid {
      margin-top: 8px;
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 6px;
    }

    .metricCard {
      border-radius: 14px;
      border: 1px solid rgba(148, 163, 184, 0.20);
      background: rgba(15, 23, 42, 0.88);
      padding: 6px 8px;
      min-height: 48px;
    }

    .metricKey {
      font-size: 9px;
      opacity: 0.75;
      font-family: var(--font-mono);
      text-transform: uppercase;
    }

    .metricVal {
      margin-top: 2px;
      font-size: 13px;
      font-weight: 900;
      font-family: var(--font-mono);
      color: #e0f2fe;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .eqBox {
      margin-top: 8px;
      padding: 8px 9px;
      border-radius: 14px;
      border: 1px dashed rgba(125, 211, 252, 0.28);
      background: rgba(2, 6, 23, 0.80);
      font-size: 11px;
      font-family: var(--font-mono);
      color: #dbeafe;
      white-space: pre-wrap;
      line-height: 1.4;
    }

    /* ---------- ARCHITECTURE OVERVIEW ---------- */

    .archGrid {
      margin-top: 8px;
      display: grid;
      grid-template-columns: 1.2fr 0.8fr;
      gap: 8px;
    }

    .archBlock {
      border-radius: 14px;
      border: 1px solid rgba(148, 163, 184, 0.24);
      background: rgba(15, 23, 42, 0.92);
      padding: 8px 9px;
      font-size: 11px;
      line-height: 1.5;
    }

    .archTitle {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #bfdbfe;
      font-weight: 800;
      margin-bottom: 4px;
    }

    .archList {
      margin-left: 12px;
      margin-top: 2px;
    }

    .archList li {
      margin-bottom: 2px;
    }

    /* ---------- CHAT PANEL ---------- */

    .chatCard {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 4px;
    }

    .toolbarLeft {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .toolbarRight {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
    }

    .toolbarBtn {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.30);
      background: rgba(15, 23, 42, 0.85);
      color: #e5e7eb;
      font-size: 11px;
      padding: 6px 9px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .toolbarBtn span.icon {
      font-size: 14px;
    }

    .toolbarBtn:active {
      transform: scale(0.98);
    }

    .moodStrip {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.25);
      background: rgba(2, 6, 23, 0.80);
      padding: 7px 12px;
      font-size: 11px;
      font-family: var(--font-mono);
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
    }

    .moodPill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.30);
      padding: 3px 9px;
      font-size: 11px;
      font-weight: 800;
    }

    .moodPill.pos {
      border-color: rgba(34, 197, 94, 0.70);
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.20);
      color: #bbf7d0;
    }

    .moodPill.neg {
      border-color: rgba(248, 113, 113, 0.85);
      box-shadow: 0 0 0 1px rgba(248, 113, 113, 0.24);
      color: #fee2e2;
    }

    .moodPill.neu {
      border-color: rgba(125, 211, 252, 0.65);
      box-shadow: 0 0 0 1px rgba(125, 211, 252, 0.18);
      color: #e0f2fe;
    }

    .moodLabelStrong {
      font-weight: 900;
    }

    .chatHistory {
      border-radius: 16px;
      border: 1px solid rgba(148, 163, 184, 0.22);
      background: rgba(2, 6, 23, 0.80);
      padding: 10px 12px;
      height: 210px;
      overflow: auto;
      font-size: 13px;
      line-height: 1.5;
    }

    .msg {
      margin-bottom: 6px;
    }

    .msgRole {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.10em;
      opacity: 0.7;
    }

    .msgRole.user  { color: #a5b4fc; }
    .msgRole.aura  { color: #bbf7d0; }

    .msgBody {
      margin-top: 1px;
      white-space: pre-wrap;
    }

    .inputRow {
      display: flex;
      gap: 8px;
      margin-top: 4px;
    }

    .inputBox {
      flex: 1;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.28);
      background: rgba(15, 23, 42, 0.94);
      padding: 11px 14px;
      font-size: 14px;
      color: #e5e7eb;
      outline: none;
    }

    .inputBox::placeholder {
      color: rgba(148, 163, 184, 0.85);
    }

    .sendBtn {
      border-radius: 999px;
      border: none;
      background: linear-gradient(90deg, var(--accent), rgba(34, 211, 238, 0.60));
      color: #020617;
      font-weight: 900;
      font-size: 13px;
      padding: 11px 18px;
      min-width: 92px;
      cursor: pointer;
      box-shadow: 0 12px 30px rgba(14, 165, 233, 0.22);
    }

    .sendBtn:active {
      transform: scale(0.98);
    }

    .helperText {
      margin-top: 4px;
      font-size: 11px;
      opacity: 0.78;
    }

    /* ---------- MODAL (SETTINGS) ---------- */

    .modalOverlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.55);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
      backdrop-filter: blur(10px);
    }

    .modalOverlay.show {
      display: flex;
    }

    .modal {
      width: min(880px, 96vw);
      border-radius: 18px;
      background: rgba(248, 250, 252, 0.97);
      border: 1px solid rgba(15, 23, 42, 0.18);
      box-shadow: 0 26px 80px rgba(0, 0, 0, 0.42);
      overflow: hidden;
    }

    .modalHeader {
      padding: 10px 14px;
      border-bottom: 1px solid rgba(15, 23, 42, 0.10);
      background: rgba(255, 255, 255, 0.96);
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 8px;
    }

    .modalTitle {
      font-weight: 800;
      font-size: 14px;
    }

    .modalSub {
      font-size: 11px;
      opacity: 0.75;
    }

    .modalClose {
      border: none;
      background: transparent;
      font-size: 22px;
      cursor: pointer;
      line-height: 1;
      padding: 0 4px;
      opacity: 0.7;
    }

    .modalBody {
      padding: 12px 14px 14px;
      max-height: 70vh;
      overflow: auto;
      font-size: 13px;
      color: #0f172a;
    }

    .settingsGrid {
      display: grid;
      grid-template-columns: 0.9fr 1.1fr;
      gap: 12px;
    }

    .settingsSection {
      border-radius: 14px;
      border: 1px solid rgba(15, 23, 42, 0.12);
      background: #f9fafb;
      padding: 10px;
    }

    .settingsTitle {
      font-size: 12px;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 0.10em;
      margin-bottom: 4px;
    }

    .settingsText {
      font-size: 12px;
      opacity: 0.8;
      margin-bottom: 6px;
      line-height: 1.4;
    }

    .fieldLabel {
      font-size: 11px;
      opacity: 0.75;
      display: block;
      margin-bottom: 3px;
    }

    .fieldInput, .fieldSelect, .fieldArea {
      width: 100%;
      border-radius: 10px;
      border: 1px solid rgba(15, 23, 42, 0.18);
      padding: 8px 10px;
      font-size: 13px;
      outline: none;
      background: #ffffff;
    }

    .fieldArea {
      min-height: 80px;
      resize: vertical;
      line-height: 1.4;
    }

    .settingsActions {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 8px;
      flex-wrap: wrap;
    }

    .btn {
      border-radius: 10px;
      border: 1px solid transparent;
      font-size: 12px;
      font-weight: 800;
      padding: 8px 12px;
      cursor: pointer;
    }

    .btn-primary {
      background: #0f172a;
      color: #f9fafb;
      border-color: #020617;
    }

    .btn-outline {
      background: #f1f5f9;
      color: #0f172a;
      border-color: rgba(15, 23, 42, 0.15);
    }

    .btn-danger {
      background: #fee2e2;
      color: #7f1d1d;
      border-color: rgba(248, 113, 113, 0.6);
    }

    /* ---------- TOAST ---------- */

    .toast {
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%) translateY(14px);
      padding: 6px 14px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.40);
      background: rgba(15, 23, 42, 0.96);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.55);
      color: #e5e7eb;
      font-size: 12px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.16s ease, transform 0.16s ease;
      z-index: 1000;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    /* ---------- RESPONSIVE ---------- */

    @media (max-width: 780px) {
      .archGrid { grid-template-columns: 1fr; }
      .settingsGrid { grid-template-columns: 1fr; }
    }

  </style>
</head>
<body>
  <div class="app">
    <!-- HEADER -->
    <header class="top">
      <div class="brand">AURA-X Œ©</div>
      <div class="brandSub">Emotional Continuity OS ‚Äì Professional Prototype</div>
      <div class="brandMeta">
        TM = current signal ¬∑ BM = lifetime blueprint ¬∑ Goal = stable emotional trajectory, not single answers.
      </div>

      <div class="ethicBar">
        <div class="ethicTitle">Continuity Principle</div>
        <div class="ethicBody">
          Minimize actions that amplify harmful emotion in you or others.
          Prefer decisions that increase shared, durable, and ethically grounded positive feeling,
          even when the short-term answer is uncomfortable.
        </div>
      </div>

      <div class="statusPill" id="statusPill">
        CONTINUITY ENGINE ONLINE ¬∑ LOCAL PROTOTYPE ¬∑ NO CLOUD MEMORY
      </div>
    </header>

    <!-- MAIN -->
    <main class="main">
      <div class="row">
        <!-- LEFT COLUMN: CONSOLE + METRICS + ARCHITECTURE -->
        <section class="col-left">
          <!-- System Console -->
          <div class="card">
            <div class="cardHeader">
              <div class="cardTitle">System Console</div>
              <button class="toolbarBtn" id="btnOpenSettings">
                <span class="icon">‚öôÔ∏è</span><span>Settings</span>
              </button>
            </div>
            <p class="cardSub">
              Internal log of how AURA-X Œ© is interpreting the dialogue: TM/BM values, decisions, and safety checks.
            </p>

            <div class="console" id="console">
              <span class="logLine sys">
[system] AURA-X Œ© booted. Continuity engine ready. No conversation history loaded (session-only prototype).
              </span>
            </div>

            <div class="badgeRow">
              <span class="badge" id="badgeLLM">LLM: offline (stub)</span>
              <span class="badge" id="badgeLearning">Learning: passively tracking patterns</span>
              <span class="badge" id="badgeSafety">Safety: emotion-first, non-clinical</span>
            </div>
          </div>

          <!-- Continuity Metrics -->
          <div class="card" style="margin-top: 10px;">
            <div class="cardHeader">
              <div class="cardTitle">Continuity Metrics</div>
              <div class="cardTag">TM ¬∑ BM ¬∑ E‚ÇÄ</div>
            </div>
            <p class="cardSub">
              Lightweight numerical view of the current emotional trajectory. These are not diagnoses ‚Äì they are internal
              engineering signals that help AURA-X Œ© stay consistent.
            </p>

            <div class="metricsGrid">
              <div class="metricCard">
                <div class="metricKey">E‚ÇÄ (overall)</div>
                <div class="metricVal" id="valE0">0.00</div>
              </div>
              <div class="metricCard">
                <div class="metricKey">TM valence</div>
                <div class="metricVal" id="valTM">0.00</div>
              </div>
              <div class="metricCard">
                <div class="metricKey">TM intensity</div>
                <div class="metricVal" id="valIntensity">0.00</div>
              </div>
              <div class="metricCard">
                <div class="metricKey">BM resonance</div>
                <div class="metricVal" id="valResonance">0.00</div>
              </div>
              <div class="metricCard">
                <div class="metricKey">Œª<sub>faith</sub></div>
                <div class="metricVal" id="valFaith">0.20</div>
              </div>
              <div class="metricCard">
                <div class="metricKey">Œª<sub>sys</sub></div>
                <div class="metricVal" id="valSys">0.30</div>
              </div>
              <div class="metricCard">
                <div class="metricKey">Œª<sub>trc</sub></div>
                <div class="metricVal" id="valTrc">0.25</div>
              </div>
              <div class="metricCard">
                <div class="metricKey">D (decay)</div>
                <div class="metricVal" id="valD">0.25</div>
              </div>
            </div>

            <div class="eqBox" id="eqBox">
E‚ÇÄ = tanh( R(TM, BM) ‚àí D + Œª_faith + Œª_sys + Œª_trc )

Waiting for first message‚Ä¶
            </div>
          </div>

          <!-- Architecture Overview -->
          <div class="card" style="margin-top: 10px;">
            <div class="cardHeader">
              <div class="cardTitle">Architecture Overview</div>
              <div class="cardTag">High-level</div>
            </div>
            <p class="cardSub">
              Conceptual layout of AURA-X Œ© in this prototype. A developer can map each block to real services or models.
            </p>

            <div class="archGrid">
              <div class="archBlock">
                <div class="archTitle">Continuity Stack</div>
                <ul class="archList">
                  <li><b>TM layer</b> ‚Äì current sentence, context window, surface sentiment.</li>
                  <li><b>BM layer</b> ‚Äì internal themes (research, family, health, legal, faith).</li>
                  <li><b>Resonance</b> ‚Äì how strongly TM matches BM themes.</li>
                  <li><b>E‚ÇÄ</b> ‚Äì global emotional continuity signal from the equation.</li>
                </ul>
              </div>
              <div class="archBlock">
                <div class="archTitle">Interfaces</div>
                <ul class="archList">
                  <li><b>Dialogue</b> ‚Äì this chat panel (human-facing).</li>
                  <li><b>Console</b> ‚Äì engineering logs (developer-facing).</li>
                  <li><b>LLM Socket</b> ‚Äì offline + online helper (optional).</li>
                  <li><b>Export</b> ‚Äì future hook for journals / clinical tools.</li>
                </ul>
              </div>
            </div>
          </div>
        </section>

        <!-- RIGHT COLUMN: DIALOGUE -->
        <section class="col-right">
          <div class="card chatCard">
            <div class="toolbar">
              <div class="toolbarLeft">
                <button class="toolbarBtn" id="btnToneSoft">
                  <span class="icon">üå§Ô∏è</span><span>Softer</span>
                </button>
                <button class="toolbarBtn" id="btnToneNeutral">
                  <span class="icon">‚öñÔ∏è</span><span>Neutral</span>
                </button>
                <button class="toolbarBtn" id="btnToneDirect">
                  <span class="icon">üß±</span><span>More direct</span>
                </button>
              </div>
              <div class="toolbarRight">
                <button class="toolbarBtn" id="btnExportSession">
                  <span class="icon">üì§</span><span>Export session</span>
                </button>
              </div>
            </div>

            <div class="moodStrip" id="moodStrip">
              <span id="moodPill" class="moodPill neu">
                <span class="moodLabelStrong" id="moodLabel">Calm, listening</span>
              </span>
              <span>E‚ÇÄ: <b id="moodE0Label">0.00</b></span>
              <span>¬∑ TM: <b id="moodTMLabel">0.00</b></span>
              <span>¬∑ BM themes: <b id="moodThemeLabel">none detected</b></span>
            </div>

            <div class="chatHistory" id="chatHistory">
              <div class="msg">
                <div class="msgRole aura">AURA-X Œ©</div>
                <div class="msgBody">
Welcome. This is a professional prototype of an Emotional Continuity OS.

You can type anything that reflects what you are actually thinking or feeling right now.
I will respond in natural language, but I will also quietly track TM, BM, and E‚ÇÄ in the background.
                </div>
              </div>
            </div>

            <div class="inputRow">
              <input
                id="userInput"
                class="inputBox"
                placeholder="Describe what is on your mind in ordinary language ‚Äì no special format needed." />
              <button id="sendBtn" class="sendBtn">Send</button>
            </div>
            <div class="helperText">
              Tip: You can mention multiple areas in one sentence (e.g. ‚ÄúI‚Äôm tired, worried about court, but excited about my research‚Äù).
              The system will try to separate these into TM and BM themes.
            </div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <!-- SETTINGS MODAL -->
  <div class="modalOverlay" id="settingsOverlay">
    <div class="modal">
      <div class="modalHeader">
        <div>
          <div class="modalTitle">AURA-X Œ© ‚Äì System Settings</div>
          <div class="modalSub">High-level configuration for persona, continuity, and LLM integration.</div>
        </div>
        <button class="modalClose" id="settingsClose">&times;</button>
      </div>
      <div class="modalBody">
        <div class="settingsGrid">
          <!-- LEFT: CONTINUITY + PERSONA -->
          <div class="settingsSection">
            <div class="settingsTitle">Continuity parameters</div>
            <p class="settingsText">
              These parameters shape how strongly the system reacts to emotional content. This is not a medical configuration ‚Äì
              it is a tuning surface for continuity behaviour.
            </p>

            <label class="fieldLabel">Œª<sub>faith</sub> (optional ethical encouragement)</label>
            <input type="number" step="0.05" id="fieldLambdaFaith" class="fieldInput" />

            <label class="fieldLabel" style="margin-top: 6px;">Œª<sub>sys</sub> (system stability)</label>
            <input type="number" step="0.05" id="fieldLambdaSys" class="fieldInput" />

            <label class="fieldLabel" style="margin-top: 6px;">Œª<sub>trc</sub> (truth / reality pressure)</label>
            <input type="number" step="0.05" id="fieldLambdaTrc" class="fieldInput" />

            <label class="fieldLabel" style="margin-top: 6px;">D (decay / cooling)</label>
            <input type="number" step="0.05" id="fieldD" class="fieldInput" />

            <div class="settingsActions">
              <button class="btn btn-outline" id="btnResetContinuity">Reset</button>
              <button class="btn btn-primary" id="btnApplyContinuity">Apply</button>
            </div>

            <hr style="margin: 10px 0; border: none; border-top: 1px dashed rgba(15, 23, 42, 0.15);" />

            <div class="settingsTitle">Persona</div>
            <p class="settingsText">
              One-sentence summary of how AURA-X Œ© should sound (for this device only).
            </p>
            <textarea id="fieldPersona" class="fieldArea"
              placeholder="Example: Calm, analytic, but emotionally aware; avoids drama, but does not minimize pain."></textarea>
          </div>

          <!-- RIGHT: LLM + EXPORT -->
          <div class="settingsSection">
            <div class="settingsTitle">LLM integration</div>
            <p class="settingsText">
              This prototype runs with a local rule-based core. A developer can optionally connect an LLM endpoint (for example
              OpenAI, xAI, or a private gateway). Configuration here is only stored in this browser.
            </p>

            <label class="fieldLabel">API endpoint</label>
            <input id="fieldEndpoint" class="fieldInput"
              value="https://api.openai.com/v1/chat/completions" />

            <label class="fieldLabel" style="margin-top: 6px;">Model name</label>
            <input id="fieldModel" class="fieldInput" value="gpt-4o-mini" />

            <label class="fieldLabel" style="margin-top: 6px;">API key (session only)</label>
            <input id="fieldApiKey" class="fieldInput" placeholder="sk-..." />

            <div class="settingsActions">
              <button class="btn btn-primary" id="btnSaveLLM">Save LLM config</button>
            </div>

            <hr style="margin: 10px 0; border: none; border-top: 1px dashed rgba(15, 23, 42, 0.15);" />

            <div class="settingsTitle">Export & privacy</div>
            <p class="settingsText">
              This prototype stores conversation only in memory while the page is open. A developer can swap this layer with a
              secure, encrypted store if required.
            </p>

            <div class="settingsActions">
              <button class="btn btn-danger" id="btnClearSession">Clear in-memory session</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- TOAST -->
  <div class="toast" id="toast"></div>

  <script>
    // -----------------------------
    // Simple professional TM‚ÄìBM logic
    // -----------------------------

    const consoleEl      = document.getElementById("console");
    const chatHistoryEl  = document.getElementById("chatHistory");
    const userInputEl    = document.getElementById("userInput");
    const sendBtn        = document.getElementById("sendBtn");
    const toastEl        = document.getElementById("toast");

    const valE0El        = document.getElementById("valE0");
    const valTMEl        = document.getElementById("valTM");
    const valIntensityEl = document.getElementById("valIntensity");
    const valResEl       = document.getElementById("valResonance");
    const valFaithEl     = document.getElementById("valFaith");
    const valSysEl       = document.getElementById("valSys");
    const valTrcEl       = document.getElementById("valTrc");
    const valDEl         = document.getElementById("valD");
    const eqBoxEl        = document.getElementById("eqBox");

    const moodStripEl     = document.getElementById("moodStrip");
    const moodPillEl      = document.getElementById("moodPill");
    const moodLabelEl     = document.getElementById("moodLabel");
    const moodE0LabelEl   = document.getElementById("moodE0Label");
    const moodTMLabelEl   = document.getElementById("moodTMLabel");
    const moodThemeLabelEl= document.getElementById("moodThemeLabel");

    const btnToneSoft     = document.getElementById("btnToneSoft");
    const btnToneNeutral  = document.getElementById("btnToneNeutral");
    const btnToneDirect   = document.getElementById("btnToneDirect");
    const btnExportSession= document.getElementById("btnExportSession");

    const settingsOverlay = document.getElementById("settingsOverlay");
    const settingsClose   = document.getElementById("settingsClose");
    const btnOpenSettings = document.getElementById("btnOpenSettings");

    const fieldLambdaFaith= document.getElementById("fieldLambdaFaith");
    const fieldLambdaSys  = document.getElementById("fieldLambdaSys");
    const fieldLambdaTrc  = document.getElementById("fieldLambdaTrc");
    const fieldD          = document.getElementById("fieldD");
    const btnResetCont    = document.getElementById("btnResetContinuity");
    const btnApplyCont    = document.getElementById("btnApplyContinuity");

    const fieldPersona    = document.getElementById("fieldPersona");

    const fieldEndpoint   = document.getElementById("fieldEndpoint");
    const fieldModel      = document.getElementById("fieldModel");
    const fieldApiKey     = document.getElementById("fieldApiKey");
    const btnSaveLLM      = document.getElementById("btnSaveLLM");
    const btnClearSession = document.getElementById("btnClearSession");

    const badgeLLM        = document.getElementById("badgeLLM");

    // Internal parameters (can be adjusted from Settings)
    let lambdaFaith = 0.20;
    let lambdaSys   = 0.30;
    let lambdaTrc   = 0.25;
    let decayD      = 0.25;

    // Persona string (human tone guidance)
    let persona = "Calm, analytic, emotionally aware; straightforward but not harsh.";

    // Minimal lexical sets for quick sentiment / theme detection
    const positiveWords = [
      "good","grateful","hope","excited","confident","calm","peace","happy","relief","relieved"
    ];
    const negativeWords = [
      "bad","upset","angry","anxious","anxiety","afraid","scared","sad","tired","exhausted",
      "depressed","panic","stressed","stress","worried","worry","overwhelmed","broken"
    ];
    const intensityWords = [
      "very","really","extremely","so much","soooo","too much","incredibly","deeply","severely"
    ];
    const bmThemes = {
      research: ["research","paper","article","theory","experiment","data","model","algorithm"],
      family:   ["family","wife","husband","children","kids","mother","father","parents","home"],
      health:   ["health","sleep","tired","headache","sick","illness","fever","pain","energy"],
      legal:    ["court","case","hearing","judge","lawyer","legal","police"],
      faith:    ["god","allah","prayer","dua","quran","church","mosque","faith","spiritual"]
    };

    let conversation = [];

    // Toast
    function showToast(message) {
      toastEl.textContent = message;
      toastEl.classList.add("show");
      setTimeout(() => toastEl.classList.remove("show"), 1700);
    }

    // Logging to console pane
    function logToConsole(kind, text) {
      const span = document.createElement("span");
      span.classList.add("logLine");
      if (kind === "system") span.classList.add("sys");
      if (kind === "user")   span.classList.add("user");
      if (kind === "aura")   span.classList.add("aura");
      span.textContent = text;
      consoleEl.appendChild(span);
      consoleEl.scrollTop = consoleEl.scrollHeight;
    }

    // Chat history
    function addChatMessage(role, text) {
      const wrapper = document.createElement("div");
      wrapper.classList.add("msg");

      const roleEl = document.createElement("div");
      roleEl.classList.add("msgRole", role);
      roleEl.textContent = role === "user" ? "You" : "AURA-X Œ©";

      const bodyEl = document.createElement("div");
      bodyEl.classList.add("msgBody");
      bodyEl.textContent = text;

      wrapper.appendChild(roleEl);
      wrapper.appendChild(bodyEl);
      chatHistoryEl.appendChild(wrapper);
      chatHistoryEl.scrollTop = chatHistoryEl.scrollHeight;
    }

    // Basic math
    function tanh(x) {
      const e1 = Math.exp(x);
      const e2 = Math.exp(-x);
      return (e1 - e2) / (e1 + e2);
    }

    // Simple lexical detectors
    function detectValence(text) {
      const low = text.toLowerCase();
      let score = 0;
      positiveWords.forEach(w => { if (low.includes(w)) score += 1; });
      negativeWords.forEach(w => { if (low.includes(w)) score -= 1; });
      return score;
    }

    function detectIntensity(text) {
      const low = text.toLowerCase();
      let score = 0;
      intensityWords.forEach(w => { if (low.includes(w)) score += 1.3; });
      if (text.length > 150) score += 0.5;
      if (text.length > 260) score += 0.5;
      return score;
    }

    function detectBMResonance(text) {
      const low = text.toLowerCase();
      let total = 0;
      for (const [key, list] of Object.entries(bmThemes)) {
        let local = 0;
        list.forEach(w => {
          if (low.includes(w)) local += 0.5;
        });
        if (local > 0) {
          // Slight boost if theme appears multiple times
          total += local * 1.0;
        }
      }
      return total;
    }

    function summarizeThemes(text) {
      const low = text.toLowerCase();
      const hits = [];
      for (const [key, list] of Object.entries(bmThemes)) {
        if (list.some(w => low.includes(w))) hits.push(key);
      }
      if (!hits.length) return "none detected";
      return hits.join(", ");
    }

    function updateMetrics(tmValence, tmIntensity, resonance, e0) {
      valTMEl.textContent        = tmValence.toFixed(2);
      valIntensityEl.textContent = tmIntensity.toFixed(2);
      valResEl.textContent       = resonance.toFixed(2);
      valE0El.textContent        = e0.toFixed(2);

      valFaithEl.textContent = lambdaFaith.toFixed(2);
      valSysEl.textContent   = lambdaSys.toFixed(2);
      valTrcEl.textContent   = lambdaTrc.toFixed(2);
      valDEl.textContent     = decayD.toFixed(2);

      eqBoxEl.textContent =
`E‚ÇÄ = tanh( R(TM, BM) ‚àí D + Œª_faith + Œª_sys + Œª_trc )

R(TM, BM) = ${resonance.toFixed(2)}
TM valence = ${tmValence.toFixed(2)}
TM intensity = ${tmIntensity.toFixed(2)}
Œª_faith = ${lambdaFaith.toFixed(2)}
Œª_sys   = ${lambdaSys.toFixed(2)}
Œª_trc   = ${lambdaTrc.toFixed(2)}
D       = ${decayD.toFixed(2)}
‚Üí E‚ÇÄ    = ${e0.toFixed(2)}`;

      // Mood strip
      moodE0LabelEl.textContent = e0.toFixed(2);
      moodTMLabelEl.textContent = tmValence.toFixed(2);

      moodPillEl.classList.remove("pos", "neg", "neu");
      if (e0 > 0.15) {
        moodPillEl.classList.add("pos");
        if (e0 > 0.45) {
          moodLabelEl.textContent = "Positive, confident";
        } else {
          moodLabelEl.textContent = "Slightly positive, hopeful";
        }
      } else if (e0 < -0.15) {
        moodPillEl.classList.add("neg");
        if (e0 < -0.45) {
          moodLabelEl.textContent = "Heavy, protective mode";
        } else {
          moodLabelEl.textContent = "Concerned, sympathetic";
        }
      } else {
        moodPillEl.classList.add("neu");
        moodLabelEl.textContent = "Calm, listening";
      }
    }

    function buildAuraResponse(text, tmValence, tmIntensity, resonance, e0) {
      const themes = summarizeThemes(text);
      moodThemeLabelEl.textContent = themes;

      // High-level style based on E‚ÇÄ
      let tone = "neutral";
      if (e0 < -0.35) tone = "deep_negative";
      else if (e0 < -0.12) tone = "mild_negative";
      else if (e0 > 0.35) tone = "strong_positive";
      else if (e0 > 0.12) tone = "mild_positive";

      const themeLine = themes !== "none detected"
        ? `From an engineering perspective, your message is resonating most with these BM themes: ${themes}.`
        : `I do not see a dominant BM theme yet; that is completely fine at this stage.`;

      let opening = "";
      if (tone === "deep_negative") {
        opening =
          "I can see that what you wrote carries a lot of emotional weight. " +
          "Even in a prototype like this, my priority is to take that seriously, not to minimise it.";
      } else if (tone === "mild_negative") {
        opening =
          "There is some clear discomfort and pressure in what you wrote. " +
          "It does not sound catastrophic, but it is also not trivial.";
      } else if (tone === "strong_positive") {
        opening =
          "There is a strong positive signal in your message. " +
          "It reads like momentum ‚Äì energy that wants to move somewhere meaningful.";
      } else if (tone === "mild_positive") {
        opening =
          "Your message carries a modest but real sense of positivity. " +
          "It feels more like quiet hope than loud excitement.";
      } else {
        opening =
          "Your message feels fairly balanced ‚Äì more reflective than extreme. " +
          "That is often a good starting point for clear decisions.";
      }

      let guidance = "";
      if (tone === "deep_negative") {
        guidance =
          "If you are in immediate danger or feel you might harm yourself or someone else, " +
          "this prototype is not enough ‚Äì you would need a real human and possibly clinical support.\n\n" +
          "Within the safe zone, a practical next step is to identify one specific pressure point " +
          "we can describe more precisely together. What feels most urgent right now?";
      } else if (tone === "mild_negative") {
        guidance =
          "A realistic next step would be to name one or two concrete factors that make this period heavy. " +
          "We can then translate that into a small, testable plan instead of letting it stay as a vague cloud.";
      } else if (tone === "strong_positive") {
        guidance =
          "The useful question with strong positive energy is: how do you convert this mood into a resilient plan, " +
          "rather than a short-term spike? If you like, describe one concrete direction where you want to invest this energy.";
      } else if (tone === "mild_positive") {
        guidance =
          "We can use this small positive baseline as an anchor. " +
          "Describe one area of your life where this positive feeling would make the biggest difference " +
          "if it remained stable for a few months.";
      } else {
        guidance =
          "If you specify what you want from this conversation ‚Äì clarity, validation, or a concrete plan ‚Äì " +
          "I can shape my responses around that goal instead of guessing.";
      }

      return (
        opening + "\n\n" +
        themeLine + "\n\n" +
        guidance + "\n\n" +
        "(Note: I am not a therapist or doctor. I am an engineering prototype that models emotional continuity, " +
        "so everything I say should be interpreted as structured reflection, not as clinical advice.)"
      );
    }

    function handleUserMessage() {
      const text = userInputEl.value.trim();
      if (!text) return;

      // Add to local conversation memory
      conversation.push({ role: "user", text, ts: Date.now() });

      addChatMessage("user", text);
      logToConsole("user", "[user] " + text);

      // Compute simple metrics
      const tmValence   = detectValence(text);
      const tmIntensity = detectIntensity(text);
      const resonance   = detectBMResonance(text);

      // Raw signal
      const raw = tmValence + 0.7 * tmIntensity + 0.9 * resonance
        - decayD + lambdaFaith + lambdaSys + lambdaTrc;

      const e0 = tanh(raw / 4); // scaling

      updateMetrics(tmValence, tmIntensity, resonance, e0);
      logToConsole(
        "system",
        `[engine] TM=${tmValence.toFixed(2)}, I=${tmIntensity.toFixed(2)}, R=${resonance.toFixed(2)}, E0=${e0.toFixed(2)}`
      );

      // Build human-facing response
      const reply = buildAuraResponse(text, tmValence, tmIntensity, resonance, e0);
      conversation.push({ role: "assistant", text: reply, ts: Date.now() });

      setTimeout(() => {
        addChatMessage("aura", reply);
        logToConsole("aura", "[aura] reply generated using local TM‚ÄìBM rules + persona.");
      }, 160);

      userInputEl.value = "";
      userInputEl.focus();
    }

    sendBtn.addEventListener("click", handleUserMessage);
    userInputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        handleUserMessage();
      }
    });

    // Tone controls
    btnToneSoft.addEventListener("click", () => {
      decayD = Math.max(0.10, decayD - 0.05);
      lambdaFaith = Math.min(0.55, lambdaFaith + 0.05);
      showToast("Tone shifted: gentler and slightly more faith-weighted.");
      updateMetricDisplays();
    });

    btnToneNeutral.addEventListener("click", () => {
      lambdaFaith = 0.20;
      lambdaSys   = 0.30;
      lambdaTrc   = 0.25;
      decayD      = 0.25;
      showToast("Tone reset to neutral engineering defaults.");
      updateMetricDisplays();
    });

    btnToneDirect.addEventListener("click", () => {
      lambdaTrc = Math.min(0.55, lambdaTrc + 0.06);
      decayD    = Math.min(0.45, decayD + 0.04);
      showToast("Tone shifted: slightly firmer and more reality-oriented.");
      updateMetricDisplays();
    });

    function updateMetricDisplays() {
      valFaithEl.textContent = lambdaFaith.toFixed(2);
      valSysEl.textContent   = lambdaSys.toFixed(2);
      valTrcEl.textContent   = lambdaTrc.toFixed(2);
      valDEl.textContent     = decayD.toFixed(2);
    }

    // Export session
    btnExportSession.addEventListener("click", () => {
      if (!conversation.length) {
        showToast("No messages to export yet.");
        return;
      }
      const payload = {
        exportedAt: new Date().toISOString(),
        persona,
        continuityParameters: {
          lambdaFaith,
          lambdaSys,
          lambdaTrc,
          decayD
        },
        conversation
      };
      const blob = new Blob([JSON.stringify(payload, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "aurax-session.json";
      a.click();
      URL.revokeObjectURL(url);
      showToast("Session exported as JSON.");
    });

    // Settings modal
    function openSettings() {
      // Pre-fill fields
      fieldLambdaFaith.value = lambdaFaith.toFixed(2);
      fieldLambdaSys.value   = lambdaSys.toFixed(2);
      fieldLambdaTrc.value   = lambdaTrc.toFixed(2);
      fieldD.value           = decayD.toFixed(2);
      fieldPersona.value     = persona;
      settingsOverlay.classList.add("show");
    }

    function closeSettings() {
      settingsOverlay.classList.remove("show");
    }

    btnOpenSettings.addEventListener("click", openSettings);
    settingsClose.addEventListener("click", closeSettings);
    settingsOverlay.addEventListener("click", (e) => {
      if (e.target === settingsOverlay) closeSettings();
    });

    btnResetCont.addEventListener("click", () => {
      lambdaFaith = 0.20;
      lambdaSys   = 0.30;
      lambdaTrc   = 0.25;
      decayD      = 0.25;
      fieldLambdaFaith.value = lambdaFaith.toFixed(2);
      fieldLambdaSys.value   = lambdaSys.toFixed(2);
      fieldLambdaTrc.value   = lambdaTrc.toFixed(2);
      fieldD.value           = decayD.toFixed(2);
      updateMetricDisplays();
      showToast("Continuity parameters reset.");
    });

    btnApplyCont.addEventListener("click", () => {
      const lf = parseFloat(fieldLambdaFaith.value);
      const ls = parseFloat(fieldLambdaSys.value);
      const lt = parseFloat(fieldLambdaTrc.value);
      const d  = parseFloat(fieldD.value);
      if (Number.isFinite(lf)) lambdaFaith = lf;
      if (Number.isFinite(ls)) lambdaSys   = ls;
      if (Number.isFinite(lt)) lambdaTrc   = lt;
      if (Number.isFinite(d))  decayD      = d;
      updateMetricDisplays();
      showToast("Continuity parameters applied.");
    });

    // LLM config (stored only in JS memory for prototype)
    let llmConfig = {
      endpoint: fieldEndpoint.value,
      model: fieldModel.value,
      key: ""
    };

    btnSaveLLM.addEventListener("click", () => {
      llmConfig.endpoint = fieldEndpoint.value.trim();
      llmConfig.model    = fieldModel.value.trim();
      llmConfig.key      = fieldApiKey.value.trim();
      const status = llmConfig.key ? "configured (key in memory)" : "configured (no key)";
      badgeLLM.textContent = "LLM: " + status;
      showToast("LLM configuration saved in this session.");
    });

    btnClearSession.addEventListener("click", () => {
      conversation = [];
      while (chatHistoryEl.firstChild) chatHistoryEl.removeChild(chatHistoryEl.firstChild);
      addChatMessage(
        "aura",
        "Session cleared. Internal continuity parameters remain, but dialogue history is empty."
      );
      showToast("Session conversation cleared from memory.");
    });

    // Persona field
    fieldPersona.addEventListener("blur", () => {
      const v = fieldPersona.value.trim();
      if (v) {
        persona = v;
        showToast("Persona updated for this session.");
      }
    });

    // Initialize metric numbers in UI
    updateMetricDisplays();

    logToConsole("system", "[system] Ready. Awaiting first user message.");
  </script>
</body>
</html>